<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0A1128">
  <title>DIGIY POS PRO ‚Äî Caisse Connect√©e</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --bg: #0b1020;
      --card: #0f172a;
      --card2: #111c3a;
      --ink: #f8fafc;
      --muted: #a8b3cf;
      --line: rgba(148, 163, 184, 0.22);
      --gold: #facc15;
      --green: #22c55e;
      --danger: #fb7185;
      --blue: #38bdf8;
      --orange: #f97316;
      --shadow: 0 18px 50px rgba(0, 0, 0, 0.35);
      --r: 18px;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Ubuntu, 'Helvetica Neue', Arial, sans-serif;
      background: radial-gradient(1200px 800px at 15% 0%, rgba(56, 189, 248, 0.18), transparent 55%),
                  radial-gradient(900px 700px at 90% 10%, rgba(250, 204, 21, 0.14), transparent 50%),
                  linear-gradient(180deg, var(--bg) 0%, #050810 100%);
      background-attachment: fixed;
      color: var(--ink);
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
    }

    /* ===== CONTAINER ===== */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    @media (max-width: 768px) {
      .container {
        padding: 12px;
      }
    }

    /* ===== HEADER ===== */
    .header {
      background: var(--card);
      border-radius: var(--r);
      padding: 20px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: var(--shadow);
      border: 1px solid var(--line);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--gold), var(--orange));
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 8px 24px rgba(250, 204, 21, 0.3);
    }

    .logo-text h1 {
      margin: 0;
      font-size: 22px;
      background: linear-gradient(135deg, var(--gold), var(--orange));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .logo-text p {
      margin: 0;
      font-size: 12px;
      color: var(--muted);
    }

    .shop-info {
      text-align: right;
    }

    .shop-name {
      font-size: 16px;
      font-weight: 600;
      color: var(--ink);
      margin: 0 0 4px 0;
    }

    .license-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: linear-gradient(135deg, rgba(250, 204, 21, 0.15), rgba(34, 197, 94, 0.15));
      border: 1px solid var(--gold);
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      color: var(--gold);
    }

    .license-badge.demo {
      background: linear-gradient(135deg, rgba(251, 113, 133, 0.15), rgba(249, 115, 22, 0.15));
      border-color: var(--danger);
      color: var(--danger);
    }

    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 16px;
        text-align: center;
      }
      
      .shop-info {
        text-align: center;
      }

      .logo {
        flex-direction: column;
      }
    }

    /* ===== DEMO WARNING ===== */
    .demo-warning {
      background: linear-gradient(135deg, rgba(251, 113, 133, 0.1), rgba(249, 115, 22, 0.1));
      border: 2px solid var(--danger);
      border-radius: var(--r);
      padding: 20px;
      margin-bottom: 20px;
      text-align: center;
    }

    .demo-warning h3 {
      margin: 0 0 12px 0;
      color: var(--danger);
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .demo-counter {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin: 16px 0;
      flex-wrap: wrap;
    }

    .counter-item {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .counter-value {
      font-size: 32px;
      font-weight: 700;
      color: var(--gold);
      line-height: 1;
    }

    .counter-label {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }

    .upgrade-btn {
      margin-top: 16px;
      padding: 12px 32px;
      background: linear-gradient(135deg, var(--gold), var(--orange));
      border: none;
      border-radius: 30px;
      color: var(--bg);
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 8px 24px rgba(250, 204, 21, 0.3);
    }

    .upgrade-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(250, 204, 21, 0.4);
    }

    /* ===== MAIN GRID ===== */
    .main-grid {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 20px;
      margin-bottom: 20px;
    }

    @media (max-width: 1024px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
    }

    /* ===== PRODUCTS SECTION ===== */
    .products-section {
      background: var(--card);
      border-radius: var(--r);
      padding: 20px;
      box-shadow: var(--shadow);
      border: 1px solid var(--line);
    }

    .search-box {
      position: relative;
      margin-bottom: 20px;
    }

    .search-box input {
      width: 100%;
      padding: 14px 44px 14px 16px;
      background: var(--card2);
      border: 1px solid var(--line);
      border-radius: 12px;
      color: var(--ink);
      font-size: 15px;
      transition: all 0.3s;
    }

    .search-box input:focus {
      outline: none;
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(250, 204, 21, 0.1);
    }

    .search-box i {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
      font-size: 16px;
    }

    .category-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      overflow-x: auto;
      padding-bottom: 8px;
    }

    .category-tabs::-webkit-scrollbar {
      height: 4px;
    }

    .category-tabs::-webkit-scrollbar-thumb {
      background: var(--gold);
      border-radius: 4px;
    }

    .tab {
      padding: 10px 20px;
      background: var(--card2);
      border: 1px solid var(--line);
      border-radius: 30px;
      color: var(--muted);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.3s;
    }

    .tab.active {
      background: linear-gradient(135deg, var(--gold), var(--orange));
      color: var(--bg);
      border-color: var(--gold);
      box-shadow: 0 4px 12px rgba(250, 204, 21, 0.3);
    }

    .tab:hover:not(.active) {
      border-color: var(--gold);
      color: var(--gold);
    }

    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 16px;
      max-height: 600px;
      overflow-y: auto;
      padding-right: 8px;
    }

    @media (max-width: 768px) {
      .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 12px;
        max-height: 500px;
      }
    }

    .products-grid::-webkit-scrollbar {
      width: 6px;
    }

    .products-grid::-webkit-scrollbar-thumb {
      background: var(--gold);
      border-radius: 6px;
    }

    .product-card {
      background: var(--card2);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .product-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--gold), var(--orange));
      transform: scaleX(0);
      transition: transform 0.3s;
    }

    .product-card:hover::before {
      transform: scaleX(1);
    }

    .product-card:hover {
      transform: translateY(-4px);
      border-color: var(--gold);
      box-shadow: 0 12px 32px rgba(250, 204, 21, 0.2);
    }

    .product-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, rgba(250, 204, 21, 0.15), rgba(34, 197, 94, 0.15));
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin-bottom: 12px;
    }

    .product-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--ink);
      margin: 0 0 8px 0;
      line-height: 1.3;
    }

    .product-price {
      font-size: 16px;
      font-weight: 700;
      color: var(--gold);
    }

    .product-stock {
      font-size: 11px;
      color: var(--muted);
      margin-top: 4px;
    }

    .stock-low {
      color: var(--danger);
    }

    /* ===== CART SECTION ===== */
    .cart-section {
      background: var(--card);
      border-radius: var(--r);
      padding: 20px;
      box-shadow: var(--shadow);
      border: 1px solid var(--line);
      display: flex;
      flex-direction: column;
      max-height: calc(100vh - 240px);
    }

    .cart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--line);
    }

    .cart-header h3 {
      margin: 0;
      font-size: 18px;
      color: var(--ink);
    }

    .clear-cart {
      padding: 8px 16px;
      background: transparent;
      border: 1px solid var(--danger);
      border-radius: 8px;
      color: var(--danger);
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .clear-cart:hover {
      background: var(--danger);
      color: var(--ink);
    }

    .cart-items {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 20px;
      padding-right: 8px;
    }

    .cart-items::-webkit-scrollbar {
      width: 6px;
    }

    .cart-items::-webkit-scrollbar-thumb {
      background: var(--gold);
      border-radius: 6px;
    }

    .cart-item {
      background: var(--card2);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 12px;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .cart-item-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 12px;
    }

    .cart-item-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--ink);
      margin: 0;
      flex: 1;
    }

    .cart-item-remove {
      background: none;
      border: none;
      color: var(--danger);
      font-size: 16px;
      cursor: pointer;
      padding: 4px;
      transition: all 0.3s;
    }

    .cart-item-remove:hover {
      transform: scale(1.2);
    }

    .cart-item-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 12px;
      background: var(--bg);
      border-radius: 8px;
      padding: 4px;
    }

    .qty-btn {
      width: 32px;
      height: 32px;
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 6px;
      color: var(--gold);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .qty-btn:hover {
      background: var(--gold);
      color: var(--bg);
      border-color: var(--gold);
    }

    .qty-value {
      font-size: 16px;
      font-weight: 600;
      color: var(--ink);
      min-width: 24px;
      text-align: center;
    }

    .cart-item-price {
      font-size: 16px;
      font-weight: 700;
      color: var(--gold);
    }

    .cart-empty {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
    }

    .cart-empty i {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.3;
    }

    .cart-empty p {
      margin: 0;
      font-size: 14px;
    }

    /* ===== CART SUMMARY ===== */
    .cart-summary {
      border-top: 2px solid var(--line);
      padding-top: 16px;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .summary-label {
      color: var(--muted);
    }

    .summary-value {
      font-weight: 600;
      color: var(--ink);
    }

    .summary-total {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--line);
    }

    .summary-total .summary-label {
      font-size: 18px;
      font-weight: 600;
      color: var(--ink);
    }

    .summary-total .summary-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--gold);
    }

    .checkout-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, var(--gold), var(--orange));
      border: none;
      border-radius: 12px;
      color: var(--bg);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 16px;
      transition: all 0.3s;
      box-shadow: 0 8px 24px rgba(250, 204, 21, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .checkout-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(250, 204, 21, 0.4);
    }

    .checkout-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* ===== NAV TABS ===== */
    .nav-tabs {
      background: var(--card);
      border-radius: var(--r);
      padding: 8px;
      margin-bottom: 20px;
      display: flex;
      gap: 8px;
      box-shadow: var(--shadow);
      border: 1px solid var(--line);
      overflow-x: auto;
    }

    .nav-tab {
      flex: 1;
      padding: 12px 20px;
      background: transparent;
      border: none;
      border-radius: 10px;
      color: var(--muted);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      white-space: nowrap;
    }

    .nav-tab.active {
      background: linear-gradient(135deg, var(--gold), var(--orange));
      color: var(--bg);
      box-shadow: 0 4px 12px rgba(250, 204, 21, 0.3);
    }

    .nav-tab:hover:not(.active) {
      color: var(--gold);
      background: var(--card2);
    }

    @media (max-width: 768px) {
      .nav-tabs {
        padding: 6px;
      }
      
      .nav-tab {
        padding: 10px 16px;
        font-size: 13px;
      }
    }

    /* ===== SECTIONS ===== */
    .section {
      display: none;
      background: var(--card);
      border-radius: var(--r);
      padding: 24px;
      box-shadow: var(--shadow);
      border: 1px solid var(--line);
    }

    .section.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .section-header {
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--line);
    }

    .section-header h2 {
      margin: 0 0 8px 0;
      font-size: 24px;
      background: linear-gradient(135deg, var(--gold), var(--orange));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .section-header p {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
    }

    /* ===== HISTORY ===== */
    .history-filters {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .history-filters input,
    .history-filters select {
      flex: 1;
      min-width: 200px;
      padding: 12px 16px;
      background: var(--card2);
      border: 1px solid var(--line);
      border-radius: 10px;
      color: var(--ink);
      font-size: 14px;
    }

    .history-filters input:focus,
    .history-filters select:focus {
      outline: none;
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(250, 204, 21, 0.1);
    }

    .history-table {
      width: 100%;
      border-collapse: collapse;
      overflow-x: auto;
      display: block;
    }

    .history-table thead {
      background: var(--card2);
    }

    .history-table th {
      padding: 12px;
      text-align: left;
      font-size: 12px;
      font-weight: 600;
      color: var(--gold);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 2px solid var(--line);
    }

    .history-table td {
      padding: 16px 12px;
      border-bottom: 1px solid var(--line);
      color: var(--ink);
      font-size: 14px;
    }

    .history-table tbody tr {
      transition: all 0.3s;
      cursor: pointer;
    }

    .history-table tbody tr:hover {
      background: var(--card2);
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
    }

    .status-completed {
      background: rgba(34, 197, 94, 0.15);
      color: var(--green);
      border: 1px solid var(--green);
    }

    @media (max-width: 768px) {
      .history-table {
        font-size: 12px;
      }

      .history-table th,
      .history-table td {
        padding: 8px;
      }
    }

    /* ===== ADMIN ===== */
    .admin-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .admin-card {
      background: var(--card2);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 20px;
    }

    .admin-card h3 {
      margin: 0 0 16px 0;
      font-size: 16px;
      color: var(--gold);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--muted);
      font-size: 13px;
      font-weight: 500;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 16px;
      background: var(--bg);
      border: 1px solid var(--line);
      border-radius: 10px;
      color: var(--ink);
      font-size: 14px;
      font-family: inherit;
      transition: all 0.3s;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(250, 204, 21, 0.1);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }

    .btn {
      padding: 12px 24px;
      background: linear-gradient(135deg, var(--gold), var(--orange));
      border: none;
      border-radius: 10px;
      color: var(--bg);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 12px rgba(250, 204, 21, 0.3);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(250, 204, 21, 0.4);
    }

    .btn-secondary {
      background: var(--card2);
      color: var(--ink);
      border: 1px solid var(--line);
      box-shadow: none;
    }

    .btn-secondary:hover {
      border-color: var(--gold);
      color: var(--gold);
      box-shadow: none;
    }

    .btn-danger {
      background: linear-gradient(135deg, var(--danger), #f43f5e);
    }

    .products-list {
      max-height: 400px;
      overflow-y: auto;
      margin-top: 16px;
    }

    .product-item {
      background: var(--bg);
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 16px;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
    }

    .product-item-info {
      flex: 1;
    }

    .product-item-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--ink);
      margin: 0 0 4px 0;
    }

    .product-item-details {
      font-size: 12px;
      color: var(--muted);
    }

    .product-item-actions {
      display: flex;
      gap: 8px;
    }

    .icon-btn {
      width: 36px;
      height: 36px;
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 8px;
      color: var(--muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }

    .icon-btn:hover {
      border-color: var(--gold);
      color: var(--gold);
    }

    .icon-btn.delete:hover {
      border-color: var(--danger);
      color: var(--danger);
    }

    /* ===== MODAL ===== */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn 0.3s ease;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--r);
      padding: 32px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow);
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(40px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--line);
    }

    .modal-header h3 {
      margin: 0;
      font-size: 20px;
      color: var(--ink);
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--muted);
      font-size: 24px;
      cursor: pointer;
      padding: 4px;
      transition: all 0.3s;
    }

    .modal-close:hover {
      color: var(--danger);
      transform: rotate(90deg);
    }

    .modal-footer {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid var(--line);
    }

    .modal-footer .btn {
      flex: 1;
    }

    /* ===== ACTIVATION SCREEN ===== */
    .activation-screen {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .activation-screen.active {
      display: flex;
    }

    .activation-box {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--r);
      padding: 48px;
      max-width: 600px;
      width: 100%;
      text-align: center;
      box-shadow: var(--shadow);
    }

    .activation-icon {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, var(--gold), var(--orange));
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      margin: 0 auto 24px;
      box-shadow: 0 12px 32px rgba(250, 204, 21, 0.3);
    }

    .activation-box h2 {
      margin: 0 0 12px 0;
      font-size: 28px;
      background: linear-gradient(135deg, var(--gold), var(--orange));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .activation-box p {
      margin: 0 0 32px 0;
      color: var(--muted);
      font-size: 15px;
      line-height: 1.6;
    }

    .license-input-group {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
    }

    .license-input-group input {
      flex: 1;
      padding: 16px;
      background: var(--card2);
      border: 2px solid var(--line);
      border-radius: 12px;
      color: var(--ink);
      font-size: 16px;
      font-weight: 600;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 2px;
      transition: all 0.3s;
    }

    .license-input-group input:focus {
      outline: none;
      border-color: var(--gold);
      box-shadow: 0 0 0 4px rgba(250, 204, 21, 0.1);
    }

    .activation-actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .demo-mode-btn {
      padding: 14px 24px;
      background: var(--card2);
      border: 1px solid var(--line);
      border-radius: 12px;
      color: var(--muted);
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .demo-mode-btn:hover {
      border-color: var(--gold);
      color: var(--gold);
    }

    .activation-help {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid var(--line);
      font-size: 13px;
      color: var(--muted);
    }

    .activation-help a {
      color: var(--gold);
      text-decoration: none;
      font-weight: 600;
    }

    .activation-help a:hover {
      text-decoration: underline;
    }

    /* ===== NOTIFICATIONS ===== */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 16px 20px;
      box-shadow: var(--shadow);
      z-index: 3000;
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 300px;
      animation: slideInRight 0.3s ease;
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(100px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .notification.success {
      border-left: 4px solid var(--green);
    }

    .notification.error {
      border-left: 4px solid var(--danger);
    }

    .notification.warning {
      border-left: 4px solid var(--orange);
    }

    .notification i {
      font-size: 20px;
    }

    .notification.success i {
      color: var(--green);
    }

    .notification.error i {
      color: var(--danger);
    }

    .notification.warning i {
      color: var(--orange);
    }

    .notification-content {
      flex: 1;
    }

    .notification-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--ink);
      margin: 0 0 4px 0;
    }

    .notification-message {
      font-size: 12px;
      color: var(--muted);
      margin: 0;
    }

    @media (max-width: 768px) {
      .notification {
        right: 10px;
        left: 10px;
        min-width: auto;
      }
    }

    /* ===== LOADING ===== */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(250, 204, 21, 0.3);
      border-top-color: var(--gold);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* ===== RESPONSIVE TWEAKS ===== */
    @media (max-width: 480px) {
      .products-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .activation-box {
        padding: 32px 20px;
      }

      .license-input-group {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

  <!-- ===== ACTIVATION SCREEN ===== -->
  <div class="activation-screen" id="activationScreen">
    <div class="activation-box">
      <div class="activation-icon">ü¶Ö</div>
      <h2>DIGIY POS PRO</h2>
      <p>Bienvenue dans votre caisse connect√©e professionnelle.<br>Entrez votre code de licence pour activer.</p>
    
    <div class="license-input-group">
     <input type="text" id="licenseCode" placeholder="Colle ta licence DIGIY1..." autocomplete="off">
      </div>

      <div class="activation-actions">
        <button class="btn" onclick="activateLicense()">
          <i class="fas fa-key"></i> Activer la Licence
        </button>
        <button class="demo-mode-btn" onclick="startDemoMode()">
          <i class="fas fa-clock"></i> Essayer en Mode D√©mo (14 jours)
        </button>
      </div>

      <div class="activation-help">
        <p>Besoin d'aide ? <a href="https://wa.me/221771342889" target="_blank">Contactez le support WhatsApp</a></p>
        <p>Ou appelez: <strong>+221 77 134 28 89</strong></p>
      </div>
    </div>
  </div>

  <!-- ===== MAIN APP ===== -->
  <div class="container" id="mainApp" style="display: none;">
    
    <!-- HEADER -->
    <div class="header">
      <div class="logo">
        <div class="logo-icon">ü¶Ö</div>
        <div class="logo-text">
          <h1>DIGIY POS PRO</h1>
          <p>L'Afrique enracin√©e, connect√©e au monde</p>
        </div>
      </div>
      <div class="shop-info">
        <p class="shop-name" id="shopName">Ma Boutique</p>
        <span class="license-badge" id="licenseBadge">
          <i class="fas fa-crown"></i> D√âMO
        </span>
      </div>
    </div>

    <!-- DEMO WARNING -->
    <div class="demo-warning" id="demoWarning" style="display: none;">
      <h3><i class="fas fa-exclamation-triangle"></i> Mode D√©monstration</h3>
      <p>Vous utilisez DIGIY POS PRO en mode d√©mo limit√©</p>
      <div class="demo-counter">
        <div class="counter-item">
          <div class="counter-value" id="daysLeft">14</div>
          <div class="counter-label">Jours restants</div>
        </div>
        <div class="counter-item">
          <div class="counter-value" id="salesLeft">30</div>
          <div class="counter-label">Ventes restantes</div>
        </div>
      </div>
      <button class="upgrade-btn" onclick="showUpgradeModal()">
        <i class="fas fa-arrow-up"></i> Passer √† la version PRO - 12,900 FCFA/mois
      </button>
    </div>

    <!-- NAV TABS -->
    <div class="nav-tabs">
      <button class="nav-tab active" onclick="switchTab('pos')">
        <i class="fas fa-cash-register"></i> Caisse
      </button>
      <button class="nav-tab" onclick="switchTab('history')">
        <i class="fas fa-history"></i> Historique
      </button>
      <button class="nav-tab" onclick="switchTab('admin')">
        <i class="fas fa-cog"></i> Administration
      </button>
    </div>

    <!-- ===== POS SECTION ===== -->
    <div class="section active" id="posSection">
      <div class="main-grid">
        
        <!-- PRODUCTS -->
        <div class="products-section">
          <div class="search-box">
            <input type="text" id="searchInput" placeholder="Rechercher un produit..." onkeyup="searchProducts()">
            <i class="fas fa-search"></i>
          </div>

          <div class="category-tabs" id="categoryTabs">
            <div class="tab active" onclick="filterCategory('all')">Tous</div>
          </div>

          <div class="products-grid" id="productsGrid">
            <!-- Products will be loaded here -->
          </div>
        </div>

        <!-- CART -->
        <div class="cart-section">
          <div class="cart-header">
            <h3><i class="fas fa-shopping-cart"></i> Panier</h3>
            <button class="clear-cart" onclick="clearCart()">
              <i class="fas fa-trash"></i> Vider
            </button>
          </div>

          <div class="cart-items" id="cartItems">
            <div class="cart-empty">
              <i class="fas fa-shopping-basket"></i>
              <p>Votre panier est vide</p>
            </div>
          </div>

          <div class="cart-summary">
            <div class="summary-row">
              <span class="summary-label">Articles</span>
              <span class="summary-value" id="totalItems">0</span>
            </div>
            <div class="summary-row">
              <span class="summary-label">Sous-total</span>
              <span class="summary-value" id="subtotal">0 FCFA</span>
            </div>
            <div class="summary-row summary-total">
              <span class="summary-label">TOTAL</span>
              <span class="summary-value" id="total">0 FCFA</span>
            </div>
            <button class="checkout-btn" id="checkoutBtn" onclick="checkout()" disabled>
              <i class="fas fa-check-circle"></i> Valider la Vente
            </button>
          </div>
        </div>

      </div>
    </div>

    <!-- ===== HISTORY SECTION ===== -->
    <div class="section" id="historySection">
      <div class="section-header">
        <h2><i class="fas fa-history"></i> Historique des Ventes</h2>
        <p>Consultez toutes vos transactions</p>
      </div>

      <div class="history-filters">
        <input type="date" id="filterDate" onchange="filterHistory()">
        <select id="filterStatus" onchange="filterHistory()">
          <option value="all">Tous les statuts</option>
          <option value="completed">Termin√©</option>
        </select>
        <input type="text" id="filterSearch" placeholder="Rechercher..." onkeyup="filterHistory()">
      </div>

      <table class="history-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Heure</th>
            <th>Articles</th>
            <th>Total</th>
            <th>Statut</th>
          </tr>
        </thead>
        <tbody id="historyTableBody">
          <!-- History will be loaded here -->
        </tbody>
      </table>
    </div>

    <!-- ===== ADMIN SECTION ===== -->
    <div class="section" id="adminSection">
      <div class="section-header">
        <h2><i class="fas fa-cog"></i> Administration</h2>
        <p>G√©rez votre boutique et vos produits</p>
      </div>

      <div class="admin-grid">
        
        <!-- SHOP INFO -->
        <div class="admin-card">
          <h3><i class="fas fa-store"></i> Informations Boutique</h3>
          <div class="form-group">
            <label>Nom de la boutique</label>
            <input type="text" id="adminShopName" placeholder="Ma Boutique">
          </div>
          <div class="form-group">
            <label>Adresse</label>
            <input type="text" id="adminShopAddress" placeholder="123 Rue Example">
          </div>
          <div class="form-group">
            <label>T√©l√©phone</label>
            <input type="tel" id="adminShopPhone" placeholder="+221 77 123 45 67">
          </div>
          <button class="btn" onclick="saveShopInfo()">
            <i class="fas fa-save"></i> Enregistrer
          </button>
        </div>

        <!-- ADD PRODUCT -->
        <div class="admin-card">
          <h3><i class="fas fa-plus-circle"></i> Ajouter Produit</h3>
          <div class="form-group">
            <label>Nom du produit</label>
            <input type="text" id="productName" placeholder="Ex: Coca Cola">
          </div>
          <div class="form-group">
            <label>Cat√©gorie</label>
            <select id="productCategory">
              <option value="Boissons">Boissons</option>
              <option value="Snacks">Snacks</option>
              <option value="Alimentation">Alimentation</option>
              <option value="Hygi√®ne">Hygi√®ne</option>
              <option value="Autre">Autre</option>
            </select>
          </div>
          <div class="form-group">
            <label>Prix (FCFA)</label>
            <input type="number" id="productPrice" placeholder="500">
          </div>
          <div class="form-group">
            <label>Stock initial</label>
            <input type="number" id="productStock" placeholder="50">
          </div>
          <button class="btn" onclick="addProduct()">
            <i class="fas fa-plus"></i> Ajouter
          </button>
        </div>

        <!-- EXPORT DATA -->
        <div class="admin-card">
          <h3><i class="fas fa-download"></i> Sauvegarde</h3>
          <p style="color: var(--muted); font-size: 13px; margin-bottom: 16px;">
            Exportez vos donn√©es pour backup ou migration
          </p>
          <button class="btn-secondary btn" onclick="exportData()">
            <i class="fas fa-file-export"></i> Exporter les Donn√©es
          </button>
          <button class="btn-secondary btn" onclick="importData()" style="margin-top: 8px;">
            <i class="fas fa-file-import"></i> Importer les Donn√©es
          </button>
        </div>

      </div>

      <!-- PRODUCTS LIST -->
      <div class="admin-card" style="margin-top: 20px;">
        <h3><i class="fas fa-box"></i> Gestion des Produits</h3>
        <div class="products-list" id="adminProductsList">
          <!-- Admin products will be loaded here -->
        </div>
      </div>

    </div>

  </div>

  <!-- ===== MODALS ===== -->
  
  <!-- UPGRADE MODAL -->
  <div class="modal" id="upgradeModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-crown"></i> Passer √† la version PRO</h3>
        <button class="modal-close" onclick="closeModal('upgradeModal')">&times;</button>
      </div>

      <div style="text-align: center; padding: 20px 0;">
        <div class="activation-icon" style="margin: 0 auto 20px;">ü¶Ö</div>
        <h2 style="font-size: 32px; color: var(--gold); margin: 0 0 8px 0;">12,900 FCFA</h2>
        <p style="color: var(--muted); margin: 0 0 24px 0;">par mois / par appareil</p>

        <div style="text-align: left; background: var(--card2); padding: 20px; border-radius: 12px; margin-bottom: 24px;">
          <h4 style="margin: 0 0 12px 0; color: var(--gold);">‚ú® Fonctionnalit√©s PRO</h4>
          <ul style="margin: 0; padding-left: 20px; color: var(--muted); font-size: 14px; line-height: 2;">
            <li>Ventes illimit√©es</li>
            <li>Historique complet</li>
            <li>Gestion multi-utilisateurs</li>
            <li>Support prioritaire</li>
            <li>Mises √† jour automatiques</li>
            <li>Sauvegarde cloud Supabase</li>
          </ul>
        </div>

        <div style="background: var(--bg); padding: 16px; border-radius: 12px; border: 1px solid var(--line); margin-bottom: 20px;">
          <p style="margin: 0 0 8px 0; color: var(--muted); font-size: 13px;">Pour obtenir votre code de licence:</p>
          <a href="https://wa.me/221771342889?text=Bonjour%2C%20je%20veux%20activer%20DIGIY%20POS%20PRO" 
             target="_blank" 
             class="btn" 
             style="display: inline-flex; text-decoration: none; margin-top: 8px;">
            <i class="fab fa-whatsapp"></i> Contacter sur WhatsApp
          </a>
        </div>

        <p style="font-size: 12px; color: var(--muted);">
          Paiement s√©curis√© via Wave ou Orange Money<br>
          Activation imm√©diate apr√®s paiement
        </p>
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('upgradeModal')">Fermer</button>
      </div>
    </div>
  </div>

  <!-- EDIT PRODUCT MODAL -->
  <div class="modal" id="editProductModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-edit"></i> Modifier le Produit</h3>
        <button class="modal-close" onclick="closeModal('editProductModal')">&times;</button>
      </div>

      <div class="form-group">
        <label>Nom du produit</label>
        <input type="text" id="editProductName">
      </div>
      <div class="form-group">
        <label>Cat√©gorie</label>
        <select id="editProductCategory">
          <option value="Boissons">Boissons</option>
          <option value="Snacks">Snacks</option>
          <option value="Alimentation">Alimentation</option>
          <option value="Hygi√®ne">Hygi√®ne</option>
          <option value="Autre">Autre</option>
        </select>
      </div>
      <div class="form-group">
        <label>Prix (FCFA)</label>
        <input type="number" id="editProductPrice">
      </div>
      <div class="form-group">
        <label>Stock</label>
        <input type="number" id="editProductStock">
      </div>

      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('editProductModal')">Annuler</button>
        <button class="btn" onclick="saveEditedProduct()">
          <i class="fas fa-save"></i> Enregistrer
        </button>
      </div>
    </div>
  </div>

 <script>
/* ======================================================
   DIGIY POS PRO ‚ôæÔ∏è ‚Äî OFFLINE (INDEXEDDB) + DEMO 15J + LICENCE 31J
   ‚úÖ D√©mo d√©marre aussi via QR "cliquable" (URL)
   ‚úÖ Z√©ro Supabase / Z√©ro Cloud requis
====================================================== */

/* ---------------------------
   R√©glages
--------------------------- */
const DEMO_DAYS = 15;
const LICENSE_DAYS = 31;

/* ---------------------------
   IndexedDB (1 store KV)
--------------------------- */
const DB_NAME = "digiy_pos_db";
const STORE = "kv";
const KEY_STATE = "state";

function openDB(){
  return new Promise((resolve, reject)=>{
    const req = indexedDB.open(DB_NAME, 1);
    req.onupgradeneeded = () => req.result.createObjectStore(STORE);
    req.onsuccess = () => resolve(req.result);
    req.onerror = () => reject(req.error);
  });
}

async function idbGet(key){
  const db = await openDB();
  return new Promise((resolve)=>{
    const tx = db.transaction(STORE, "readonly");
    const q = tx.objectStore(STORE).get(key);
    q.onsuccess = () => resolve(q.result);
    q.onerror = () => resolve(null);
  });
}

async function idbSet(key, value){
  const db = await openDB();
  return new Promise((resolve)=>{
    const tx = db.transaction(STORE, "readwrite");
    tx.objectStore(STORE).put(value, key);
    tx.oncomplete = () => resolve(true);
    tx.onerror = () => resolve(false);
  });
}

/* ---------------------------
   Helpers UI
--------------------------- */
function showNotification(type, title, message){
  // Ton syst√®me existe d√©j√† : je le garde compatible
  try{
    const icons = {
      success: 'fa-check-circle',
      error: 'fa-exclamation-circle',
      warning: 'fa-exclamation-triangle'
    };
    const notif = document.createElement('div');
    notif.className = `notification ${type}`;
    notif.innerHTML = `
      <i class="fas ${icons[type] || icons.warning}"></i>
      <div class="notification-content">
        <div class="notification-title">${title}</div>
        <div class="notification-message">${message}</div>
      </div>
    `;
    document.body.appendChild(notif);
    setTimeout(()=>{ notif.remove(); }, 2800);
  }catch(e){
    alert(`${title}\n${message}`);
  }
}

function fmtFCFA(n){
  try{ return (n||0).toLocaleString() + " FCFA"; }catch{ return n+" FCFA"; }
}

/* ---------------------------
   State (tout offline)
--------------------------- */
let appState = {
  // Mode
  license: null,        // { exp:number, device:string|null }
  demoStart: null,      // ISO string
  demoDays: DEMO_DAYS,

  // Boutique + data
  shopInfo: { name:'Ma Boutique', address:'', phone:'' },
  products: [],
  cart: [],
  history: [],
  currentEditProductId: null,
  currentCategory: 'all',

  // Device lock
  deviceId: null
};

async function loadState(){
  const saved = await idbGet(KEY_STATE);
  if(saved && typeof saved === "object"){
    appState = { ...appState, ...saved };
  }
}

async function saveState(){
  await idbSet(KEY_STATE, appState);
}

/* ---------------------------
   Device ID (anti-partage)
--------------------------- */
function genId(){
  const a = crypto.getRandomValues(new Uint8Array(16));
  return [...a].map(b=>b.toString(16).padStart(2,'0')).join('');
}
async function ensureDeviceId(){
  if(!appState.deviceId){
    appState.deviceId = "DEV-" + genId();
    await saveState();
  }
  return appState.deviceId;
}

/* ---------------------------
   D√©mo
--------------------------- */
function demoIsValid(){
  if(!appState.demoStart) return false;
  const start = new Date(appState.demoStart).getTime();
  const ms = appState.demoDays * 86400000;
  return Date.now() < (start + ms);
}
function demoDaysLeft(){
  if(!appState.demoStart) return 0;
  const start = new Date(appState.demoStart).getTime();
  const end = start + appState.demoDays * 86400000;
  const diff = end - Date.now();
  return Math.max(0, Math.ceil(diff / 86400000));
}
async function startDemoMode(){
  if(appState.license) {
    showNotification("warning","D√©j√† PRO","Licence active d√©tect√©e.");
    return;
  }
  if(!appState.demoStart){
    appState.demoStart = new Date().toISOString();
    await saveState();
  }
  showNotification("success","D√©mo activ√©e",`${DEMO_DAYS} jours offerts.`);
  bootApp();
  updateDemoUI();
}

/* ---------------------------
   D√©mo via QR "cliquable" (URL)
   -> QR ouvre : https://tonsite/index.html?demo=15
   -> ou ?demo=15&ref=CHEZ-XX
--------------------------- */
async function autoStartDemoFromURL(){
  const u = new URL(location.href);
  const demo = u.searchParams.get("demo");
  if(String(demo) === String(DEMO_DAYS) && !appState.demoStart && !appState.license){
    appState.demoStart = new Date().toISOString();
    await saveState();
    showNotification("success","D√©mo activ√©e","D√©marr√©e via QR / lien.");
    // Nettoie l‚ÄôURL (propre)
    u.searchParams.delete("demo");
    u.searchParams.delete("ref");
    history.replaceState({}, "", u.toString());
  }
}

/* ---------------------------
   Licence PRO (31 jours)
   Format recommand√© : DIGIY1.<base64url(payload)>
   payload = { exp:number(ms), device?:string|null, plan:"PRO" }
   ‚úÖ Si device est pr√©sent, on v√©rifie que √ßa correspond au deviceId local.
--------------------------- */
function base64urlDecodeToJson(b64u){
  const b64 = b64u.replace(/-/g,'+').replace(/_/g,'/');
  const pad = "=".repeat((4 - (b64.length % 4)) % 4);
  const str = atob(b64 + pad);
  return JSON.parse(str);
}

function parseLicense(input){
  const s = (input||"").trim();
  if(!s.startsWith("DIGIY1.")) return null;
  const parts = s.split(".");
  if(parts.length < 2) return null;
  try{
    const payload = base64urlDecodeToJson(parts[1]);
    if(!payload || !payload.exp) return null;
    return payload;
  }catch(e){
    return null;
  }
}

function licenseIsValid(){
  if(!appState.license?.exp) return false;
  return Date.now() < Number(appState.license.exp);
}

function licenseDaysLeft(){
  if(!appState.license?.exp) return 0;
  const diff = Number(appState.license.exp) - Date.now();
  return Math.max(0, Math.ceil(diff / 86400000));
}

/* ---------------------------
   Activation licence (via input)
--------------------------- */
async function activateLicense(){
  const code = document.getElementById('licenseCode').value.trim();
  if(!code){
    showNotification('error','Code requis','Colle ta licence DIGIY1.');
    return;
  }

  await ensureDeviceId();

  const payload = parseLicense(code);
  if(!payload){
    showNotification('error','Licence invalide','Format DIGIY1 non reconnu.');
    return;
  }

  // V√©rifie expiration
  if(Date.now() >= Number(payload.exp)){
    showNotification('error','Expir√©e','Cette licence est d√©j√† p√©rim√©e.');
    return;
  }

  // V√©rifie device lock si pr√©sent
  const localDev = appState.deviceId;
  if(payload.device && payload.device !== localDev){
    showNotification('error','Licence bloqu√©e','Cette licence est li√©e √† un autre appareil.');
    return;
  }

  // ‚úÖ OK -> active
  appState.license = {
    exp: Number(payload.exp),
    device: payload.device || null,
    plan: payload.plan || "PRO"
  };

  // Stop d√©mo si elle existait
  appState.demoStart = null;

  await saveState();

  showNotification('success','Activ√©','Licence PRO active ‚úÖ');
  document.getElementById('activationScreen').classList.remove('active');
  bootApp();
}

/* ---------------------------
   Blocage si ni d√©mo ni licence
--------------------------- */
function hardBlock(){
  document.body.innerHTML = `
  <div style="background:#020617;color:white;height:100vh;display:flex;align-items:center;justify-content:center">
    <div style="text-align:center;background:#030712;padding:40px;border-radius:18px;border:1px solid gold;max-width:520px">
      <h2 style="color:gold;margin-top:0">DIGIY POS verrouill√©</h2>
      <p>D√©mo termin√©e et aucune licence active.<br>Active ta licence PRO pour continuer.</p>
      <a href="https://wa.me/221771342889?text=Activation%20DIGIY%20POS%20PRO"
         style="background:gold;color:black;padding:12px 20px;border-radius:12px;text-decoration:none;font-weight:800;display:inline-block;margin-top:10px">
        Activer via WhatsApp
      </a>
    </div>
  </div>`;
}

/* ---------------------------
   UI : badge + √©cran demo warning
--------------------------- */
function updateBadge(){
  const badge = document.getElementById('licenseBadge');
  if(!badge) return;

  if(licenseIsValid()){
    badge.classList.remove('demo');
    badge.innerHTML = `<i class="fas fa-check-circle"></i> PRO ‚Ä¢ ${licenseDaysLeft()}j`;
  } else if(demoIsValid()){
    badge.classList.add('demo');
    badge.innerHTML = `<i class="fas fa-clock"></i> D√âMO ‚Ä¢ ${demoDaysLeft()}j`;
  } else {
    badge.classList.add('demo');
    badge.innerHTML = `<i class="fas fa-lock"></i> INACTIF`;
  }
}

function updateDemoUI(){
  const warn = document.getElementById('demoWarning');
  if(!warn) return;

  if(demoIsValid() && !licenseIsValid()){
    warn.style.display = 'block';
    const d = document.getElementById('daysLeft');
    if(d) d.textContent = demoDaysLeft();

    // Tu as aussi "salesLeft" dans ton UI : on met ‚àû (pas de limite ventes)
    const s = document.getElementById('salesLeft');
    if(s) s.textContent = "‚àû";
  } else {
    warn.style.display = 'none';
  }
}

/* ---------------------------
   Boot app (ta logique UI existante)
   -> on garde ton fonctionnement, mais storage = IndexedDB
--------------------------- */
function bootApp(){
  // Si besoin d‚Äôafficher l‚Äôapp
  document.getElementById('mainApp').style.display = 'block';
  document.getElementById('activationScreen').classList.remove('active');

  // Shop name
  document.getElementById('shopName').textContent = appState.shopInfo?.name || "Ma Boutique";

  // Cat√©gories / produits / panier / historique
  if(!appState.products || appState.products.length===0){
    loadDefaultProducts();
  }

  renderProducts();
  renderCart();
  renderHistory();
  loadAdminData();

  updateBadge();
  updateDemoUI();
}

/* ---------------------------
   Ton contenu POS (produits/cart/history/admin)
   -> je reprends tes fonctions existantes (adapt√©es √† saveState IndexedDB)
--------------------------- */

function loadDefaultProducts(){
  appState.products = [
    { id: 1, name: 'Coca Cola', category: 'Boissons', price: 500, stock: 50, icon: 'ü•§' },
    { id: 2, name: 'Fanta', category: 'Boissons', price: 500, stock: 45, icon: 'ü•§' },
    { id: 3, name: 'Eau Min√©rale', category: 'Boissons', price: 300, stock: 100, icon: 'üíß' },
    { id: 4, name: 'Chips', category: 'Snacks', price: 200, stock: 60, icon: 'üçü' },
    { id: 5, name: 'Biscuits', category: 'Snacks', price: 150, stock: 80, icon: 'üç™' },
    { id: 6, name: 'Pain', category: 'Alimentation', price: 250, stock: 30, icon: 'üçû' },
    { id: 7, name: 'Lait', category: 'Alimentation', price: 800, stock: 25, icon: 'ü•õ' },
    { id: 8, name: 'Savon', category: 'Hygi√®ne', price: 400, stock: 40, icon: 'üßº' }
  ];
  saveState();
}

function renderCategories(){
  const categories = ['all', ...new Set(appState.products.map(p => p.category))];
  const tabs = document.getElementById('categoryTabs');
  tabs.innerHTML = categories.map(cat => `
    <div class="tab ${appState.currentCategory === cat ? 'active' : ''}"
         onclick="filterCategory('${cat}')">
      ${cat === 'all' ? 'Tous' : cat}
    </div>
  `).join('');
}

function renderProducts(){
  const grid = document.getElementById('productsGrid');
  const search = (document.getElementById('searchInput')?.value || "").toLowerCase();

  let filtered = appState.products.filter(p => {
    const matchCategory = appState.currentCategory === 'all' || p.category === appState.currentCategory;
    const matchSearch = p.name.toLowerCase().includes(search);
    return matchCategory && matchSearch;
  });

  renderCategories();

  if(filtered.length === 0){
    grid.innerHTML = `
      <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--muted);">
        <i class="fas fa-box-open" style="font-size: 48px; opacity: 0.3; margin-bottom: 12px;"></i>
        <p>Aucun produit trouv√©</p>
      </div>
    `;
    return;
  }

  grid.innerHTML = filtered.map(p => `
    <div class="product-card" onclick="addToCart(${p.id})">
      <div class="product-icon">${p.icon || 'üì¶'}</div>
      <div class="product-name">${p.name}</div>
      <div class="product-price">${(p.price||0).toLocaleString()} FCFA</div>
      <div class="product-stock ${p.stock < 10 ? 'stock-low' : ''}">Stock: ${p.stock}</div>
    </div>
  `).join('');
}

function filterCategory(category){
  appState.currentCategory = category;
  renderProducts();
  saveState();
}
function searchProducts(){ renderProducts(); }

function addToCart(productId){
  const product = appState.products.find(p => p.id === productId);
  if(!product || product.stock === 0){
    showNotification('error','Stock insuffisant','Produit indisponible');
    return;
  }
  const item = appState.cart.find(i => i.id === productId);
  if(item){
    if(item.quantity >= product.stock){
      showNotification('warning','Stock limit√©','Quantit√© max atteinte');
      return;
    }
    item.quantity++;
  }else{
    appState.cart.push({ id: product.id, name: product.name, price: product.price, quantity: 1 });
  }
  renderCart();
  saveState();
}

function removeFromCart(productId){
  appState.cart = appState.cart.filter(i => i.id !== productId);
  renderCart();
  saveState();
}

function updateQuantity(productId, delta){
  const item = appState.cart.find(i => i.id === productId);
  const product = appState.products.find(p => p.id === productId);
  if(!item || !product) return;

  item.quantity += delta;
  if(item.quantity <= 0){
    removeFromCart(productId);
    return;
  }
  if(item.quantity > product.stock){
    item.quantity = product.stock;
    showNotification('warning','Stock limit√©','Quantit√© max atteinte');
  }
  renderCart();
  saveState();
}

function clearCart(){
  if(appState.cart.length === 0) return;
  if(confirm('Voulez-vous vraiment vider le panier ?')){
    appState.cart = [];
    renderCart();
    saveState();
    showNotification('success','Panier vid√©','OK');
  }
}

function renderCart(){
  const container = document.getElementById('cartItems');
  const btn = document.getElementById('checkoutBtn');

  if(appState.cart.length === 0){
    container.innerHTML = `
      <div class="cart-empty">
        <i class="fas fa-shopping-basket"></i>
        <p>Votre panier est vide</p>
      </div>
    `;
    btn.disabled = true;
    updateCartSummary();
    return;
  }

  container.innerHTML = appState.cart.map(item => `
    <div class="cart-item">
      <div class="cart-item-header">
        <div class="cart-item-name">${item.name}</div>
        <button class="cart-item-remove" onclick="removeFromCart(${item.id})"><i class="fas fa-times"></i></button>
      </div>
      <div class="cart-item-controls">
        <div class="quantity-controls">
          <button class="qty-btn" onclick="updateQuantity(${item.id}, -1)">-</button>
          <span class="qty-value">${item.quantity}</span>
          <button class="qty-btn" onclick="updateQuantity(${item.id}, 1)">+</button>
        </div>
        <div class="cart-item-price">${((item.price||0) * item.quantity).toLocaleString()} FCFA</div>
      </div>
    </div>
  `).join('');

  btn.disabled = false;
  updateCartSummary();
}

function updateCartSummary(){
  const totalItems = appState.cart.reduce((s,i)=>s+i.quantity,0);
  const subtotal = appState.cart.reduce((s,i)=>s+(i.price*i.quantity),0);
  document.getElementById('totalItems').textContent = totalItems;
  document.getElementById('subtotal').textContent = fmtFCFA(subtotal);
  document.getElementById('total').textContent = fmtFCFA(subtotal);
}

function checkout(){
  if(appState.cart.length === 0) return;

  // üîí Si ni licence ni d√©mo valide -> lock
  if(!licenseIsValid() && !demoIsValid()){
    hardBlock();
    return;
  }

  // Update stock
  appState.cart.forEach(ci=>{
    const p = appState.products.find(x=>x.id===ci.id);
    if(p) p.stock -= ci.quantity;
  });

  const sale = {
    id: Date.now(),
    date: new Date().toISOString(),
    items: [...appState.cart],
    total: appState.cart.reduce((s,i)=>s+(i.price*i.quantity),0),
    status: 'completed'
  };

  appState.history.unshift(sale);
  appState.cart = [];

  saveState();
  renderProducts();
  renderCart();
  renderHistory();

  showNotification('success','Vente enregistr√©e',`Total: ${fmtFCFA(sale.total)}`);
}

function renderHistory(){
  const tbody = document.getElementById('historyTableBody');
  if(!appState.history.length){
    tbody.innerHTML = `
      <tr>
        <td colspan="5" style="text-align:center;padding:40px;color:var(--muted);">
          <i class="fas fa-receipt" style="font-size:48px;opacity:.3;margin-bottom:12px;display:block;"></i>
          Aucune vente enregistr√©e
        </td>
      </tr>`;
    return;
  }

  tbody.innerHTML = appState.history.map(sale=>{
    const d = new Date(sale.date);
    return `
      <tr onclick="showSaleDetails(${sale.id})">
        <td>${d.toLocaleDateString('fr-FR')}</td>
        <td>${d.toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'})}</td>
        <td>${sale.items.reduce((s,i)=>s+i.quantity,0)}</td>
        <td style="font-weight:600;color:var(--gold);">${fmtFCFA(sale.total)}</td>
        <td><span class="status-badge status-completed">Termin√©</span></td>
      </tr>
    `;
  }).join('');
}

function showSaleDetails(saleId){
  const sale = appState.history.find(s=>s.id===saleId);
  if(!sale) return;
  const lines = sale.items.map(i=>`${i.name} x${i.quantity} = ${fmtFCFA(i.price*i.quantity)}`).join('\n');
  alert(`D√©tails\n\n${new Date(sale.date).toLocaleString('fr-FR')}\n\n${lines}\n\nTOTAL: ${fmtFCFA(sale.total)}`);
}

/* ---- Admin ---- */
function loadAdminData(){
  document.getElementById('adminShopName').value = appState.shopInfo.name || '';
  document.getElementById('adminShopAddress').value = appState.shopInfo.address || '';
  document.getElementById('adminShopPhone').value = appState.shopInfo.phone || '';
  renderAdminProducts();
}
function saveShopInfo(){
  appState.shopInfo.name = document.getElementById('adminShopName').value || 'Ma Boutique';
  appState.shopInfo.address = document.getElementById('adminShopAddress').value || '';
  appState.shopInfo.phone = document.getElementById('adminShopPhone').value || '';
  document.getElementById('shopName').textContent = appState.shopInfo.name;
  saveState();
  showNotification('success','Enregistr√©','Boutique mise √† jour');
}

function addProduct(){
  const name = document.getElementById('productName').value.trim();
  const category = document.getElementById('productCategory').value;
  const price = parseInt(document.getElementById('productPrice').value);
  const stock = parseInt(document.getElementById('productStock').value);
  if(!name || !price || isNaN(stock)){
    showNotification('error','Champs requis','Remplis nom, prix, stock');
    return;
  }
  const icons = {Boissons:'ü•§',Snacks:'üçü',Alimentation:'üçû',Hygi√®ne:'üßº',Autre:'üì¶'};
  appState.products.push({ id: Date.now(), name, category, price, stock, icon: icons[category] || 'üì¶' });
  document.getElementById('productName').value='';
  document.getElementById('productPrice').value='';
  document.getElementById('productStock').value='';
  saveState();
  renderProducts();
  renderAdminProducts();
  showNotification('success','Produit ajout√©',name);
}

function renderAdminProducts(){
  const list = document.getElementById('adminProductsList');
  if(!appState.products.length){
    list.innerHTML = `<div style="text-align:center;padding:40px;color:var(--muted);">
      <i class="fas fa-box-open" style="font-size:48px;opacity:.3;margin-bottom:12px;"></i>
      <p>Aucun produit</p></div>`;
    return;
  }
  list.innerHTML = appState.products.map(p=>`
    <div class="product-item">
      <div class="product-item-info">
        <div class="product-item-name">${p.icon||'üì¶'} ${p.name}</div>
        <div class="product-item-details">${p.category} ‚Ä¢ ${fmtFCFA(p.price)} ‚Ä¢ Stock: ${p.stock}</div>
      </div>
      <div class="product-item-actions">
        <button class="icon-btn" onclick="editProduct(${p.id})"><i class="fas fa-edit"></i></button>
        <button class="icon-btn delete" onclick="deleteProduct(${p.id})"><i class="fas fa-trash"></i></button>
      </div>
    </div>
  `).join('');
}

function editProduct(productId){
  const p = appState.products.find(x=>x.id===productId);
  if(!p) return;
  appState.currentEditProductId = productId;
  document.getElementById('editProductName').value = p.name;
  document.getElementById('editProductCategory').value = p.category;
  document.getElementById('editProductPrice').value = p.price;
  document.getElementById('editProductStock').value = p.stock;
  openModal('editProductModal');
}

function saveEditedProduct(){
  const p = appState.products.find(x=>x.id===appState.currentEditProductId);
  if(!p) return;
  p.name = document.getElementById('editProductName').value;
  p.category = document.getElementById('editProductCategory').value;
  p.price = parseInt(document.getElementById('editProductPrice').value);
  p.stock = parseInt(document.getElementById('editProductStock').value);
  saveState();
  renderProducts();
  renderAdminProducts();
  closeModal('editProductModal');
  showNotification('success','Modifi√©',p.name);
}

function deleteProduct(productId){
  const p = appState.products.find(x=>x.id===productId);
  if(!p) return;
  if(confirm(`Supprimer "${p.name}" ?`)){
    appState.products = appState.products.filter(x=>x.id!==productId);
    saveState();
    renderProducts();
    renderAdminProducts();
    showNotification('success','Supprim√©',p.name);
  }
}

function exportData(){
  const data = JSON.stringify(appState, null, 2);
  const blob = new Blob([data], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `digiy-pos-backup-${Date.now()}.json`;
  a.click();
  showNotification('success','Export','Backup g√©n√©r√©');
}

function importData(){
  const input = document.createElement('input');
  input.type='file';
  input.accept='.json';
  input.onchange = (e)=>{
    const file = e.target.files[0];
    if(!file) return;
    const r = new FileReader();
    r.onload = async ()=>{
      try{
        const data = JSON.parse(r.result);
        appState = { ...appState, ...data };
        await saveState();
        location.reload();
      }catch{
        showNotification('error','Erreur','Fichier invalide');
      }
    };
    r.readAsText(file);
  };
  input.click();
}

/* ---- Tabs / Modals (tu avais d√©j√†) ---- */
function switchTab(tab){
  document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));
  (event?.target?.closest('.nav-tab')||document.querySelector('.nav-tab')).classList.add('active');
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  if(tab==='pos') document.getElementById('posSection').classList.add('active');
  if(tab==='history') document.getElementById('historySection').classList.add('active');
  if(tab==='admin') document.getElementById('adminSection').classList.add('active');
}

function openModal(id){ document.getElementById(id).classList.add('active'); }
function closeModal(id){ document.getElementById(id).classList.remove('active'); }
function showUpgradeModal(){ openModal('upgradeModal'); }

/* ---------------------------
   INIT
--------------------------- */
async function init(){
  await loadState();
  await ensureDeviceId();
  await autoStartDemoFromURL();

  // Si licence valide -> boot
  if(licenseIsValid()){
    bootApp();
    return;
  }

  // Si d√©mo valide -> boot
  if(demoIsValid()){
    bootApp();
    return;
  }

  // Sinon : show activation screen
  document.getElementById('activationScreen').classList.add('active');
  document.getElementById('mainApp').style.display = 'none';

  // petit refresh badge
  updateBadge();
  updateDemoUI();

  // Watchdog (au cas o√π la d√©mo expire pendant qu‚Äôil travaille)
  setInterval(()=>{
    if(!licenseIsValid() && !demoIsValid() && appState.demoStart){
      hardBlock();
    }
    updateBadge();
    updateDemoUI();
  }, 60000);
}

document.addEventListener('DOMContentLoaded', init);

// expose global (pour tes onclick HTML)
window.activateLicense = activateLicense;
window.startDemoMode = startDemoMode;
window.checkout = checkout;
window.searchProducts = searchProducts;
window.filterCategory = filterCategory;
window.addToCart = addToCart;
window.removeFromCart = removeFromCart;
window.updateQuantity = updateQuantity;
window.clearCart = clearCart;
window.saveShopInfo = saveShopInfo;
window.addProduct = addProduct;
window.exportData = exportData;
window.importData = importData;
window.switchTab = switchTab;
window.openModal = openModal;
window.closeModal = closeModal;
window.showUpgradeModal = showUpgradeModal;
window.editProduct = editProduct;
window.saveEditedProduct = saveEditedProduct;
window.deleteProduct = deleteProduct;
window.showSaleDetails = showSaleDetails;
</script>
</body>
</html>
