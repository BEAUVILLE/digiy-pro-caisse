<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIGIY POS ELITE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #fbbf24; --bg: #0f172a; --card: #1e293b;
            --text: #f8fafc; --muted: #94a3b8; --green: #22c55e; --red: #ef4444;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; }
        body { background: var(--bg); color: var(--text); padding-bottom: 20px; }

        /* √âcran de verrouillage */
        #lockScreen { 
            position: fixed; inset: 0; background: var(--bg); z-index: 9999;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }

        /* Header & Nav */
        .header { padding: 20px; background: var(--card); border-bottom: 2px solid var(--primary); display: flex; justify-content: space-between; align-items: center; }
        .nav { display: flex; gap: 10px; padding: 10px; background: #111827; overflow-x: auto; }
        .nav-btn { padding: 12px 20px; background: var(--card); border: none; color: white; border-radius: 8px; cursor: pointer; white-space: nowrap; }
        .nav-btn.active { background: var(--primary); color: black; font-weight: bold; }

        /* Layout */
        .container { padding: 15px; display: grid; grid-template-columns: 1fr 350px; gap: 15px; }
        @media (max-width: 900px) { .container { grid-template-columns: 1fr; } }

        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 15px; }
        .p-card { background: var(--card); padding: 15px; border-radius: 12px; text-align: center; cursor: pointer; border: 1px solid #334155; }
        .p-price { color: var(--primary); font-weight: bold; margin-top: 5px; }

        /* Panier */
        .cart-panel { background: var(--card); padding: 20px; border-radius: 15px; height: fit-content; border: 1px solid #334155; }
        .cart-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #334155; font-size: 14px; }
        .pay-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .btn-p { padding: 12px; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; font-size: 11px; }

        /* Pages */
        .page { display: none; padding: 15px; }
        .page.active { display: block; }
        .admin-card { background: var(--card); padding: 20px; border-radius: 15px; margin-bottom: 15px; }
        input, select { width: 100%; padding: 12px; margin-top: 10px; border-radius: 8px; border: 1px solid #334155; background: #0f172a; color: white; }
        .btn-gold { width: 100%; padding: 15px; background: var(--primary); border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

<div id="lockScreen">
    <div style="text-align: center; padding: 20px; background: var(--card); border-radius: 20px; border: 2px solid var(--primary); width: 90%; max-width: 400px;">
        <h2 style="color: var(--primary)">ESSAI TERMIN√â üîê</h2>
        <p style="margin: 15px 0">Entrez votre cl√© DIGIY-PRO-2026</p>
        <input type="text" id="keyInput" placeholder="Cl√© de licence">
        <button class="btn-gold" onclick="activate()">ACTIVER</button>
    </div>
</div>

<div id="header">
    <div class="header">
        <div>
            <h2 id="st_name">BOUTIQUE</h2>
            <small id="trial_status" style="color: var(--red)"></small>
        </div>
        <div style="font-size: 24px">ü¶Ö</div>
    </div>

    <div class="nav">
        <button class="nav-btn active" onclick="tab('pos', this)">CAISSE</button>
        <button class="nav-btn" onclick="tab('his', this)">HISTORIQUE</button>
        <button class="nav-btn" onclick="tab('adm', this)">ADMIN</button>
    </div>
</div>

<div id="pos" class="page active">
    <div class="container">
        <div id="grid" class="products-grid"></div>
        <div class="cart-panel">
            <h3>PANIER</h3>
            <div id="cartList" style="margin: 15px 0"></div>
            <h2 id="totalDisplay" style="text-align: right; color: var(--primary)">0 F</h2>
            <div class="pay-grid">
                <button class="btn-p" style="background:var(--green)" onclick="pay('ESPECE')">ESPECE</button>
                <button class="btn-p" style="background:#38bdf8" onclick="pay('WAVE')">WAVE</button>
                <button class="btn-p" style="background:#f97316" onclick="pay('OM')">ORANGE</button>
                <button class="btn-p" style="background:#a855f7" onclick="pay('CARTE')">CARTE</button>
                <button class="btn-p" style="background:#64748b" onclick="pay('CHEQUE')">CHEQUE</button>
                <button class="btn-p" style="background:var(--red)" onclick="pay('CREDIT')">CREDIT</button>
            </div>
        </div>
    </div>
</div>

<div id="his" class="page">
    <div class="admin-card">
        <h3>REVENU DU JOUR : <span id="dayRev" style="color:var(--green)">0 F</span></h3>
    </div>
    <div class="admin-card">
        <h3>DETTES CLIENTS : <span id="debtTotal" style="color:var(--red)">0 F</span></h3>
        <div id="debts" style="margin-top: 15px"></div>
    </div>
</div>

<div id="adm" class="page">
    <div class="admin-card" id="activationBox">
        <h3>ACTIVER LICENCE</h3>
        <input type="text" id="admKey" placeholder="Entrez la cl√©">
        <button class="btn-gold" onclick="activateAdmin()">D√âBLOQUER PRO</button>
    </div>
    <div class="admin-card">
        <h3>AJOUTER PRODUIT</h3>
        <input type="text" id="p_n" placeholder="Nom">
        <input type="number" id="p_p" placeholder="Prix">
        <input type="number" id="p_s" placeholder="Stock">
        <button class="btn-gold" onclick="addP()">AJOUTER</button>
    </div>
    <div class="admin-card">
        <h3>INFOS BOUTIQUE</h3>
        <input type="text" id="c_n" placeholder="Nom Boutique">
        <button class="btn-gold" onclick="saveC()">ENREGISTRER</button>
    </div>
</div>

<script>
// VARIABLES
const TRIAL = 15;
let db = {
    active: localStorage.getItem('digiy_active') === 'true',
    start: localStorage.getItem('digiy_start') || Date.now(),
    prods: JSON.parse(localStorage.getItem('digiy_prods')) || [{id:1, name:"Produit Test", price:1000, stock:50}],
    sales: JSON.parse(localStorage.getItem('digiy_sales')) || [],
    name: localStorage.getItem('digiy_name') || "Ma Boutique",
    cart: []
};
if(!localStorage.getItem('digiy_start')) localStorage.setItem('digiy_start', db.start);

// FONCTIONS
function tab(id, btn) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    btn.classList.add('active');
    render();
}

function render() {
    // Check Licence
    const diff = Date.now() - parseInt(db.start);
    const passed = Math.floor(diff / (1000 * 60 * 60 * 24));
    const left = Math.max(0, TRIAL - passed);
    
    if(!db.active && left <= 0) {
        document.getElementById('lockScreen').style.display = 'flex';
    }
    
    document.getElementById('st_name').innerText = db.name;
    document.getElementById('trial_status').innerText = db.active ? "VERSION PRO" : "ESSAI : " + left + " JOURS";
    if(db.active) document.getElementById('activationBox').style.display = 'none';

    // Grid
    const g = document.getElementById('grid');
    g.innerHTML = db.prods.map(p => `
        <div class="p-card" onclick="addToCart(${p.id})">
            <b>${p.name}</b><br>
            <span class="p-price">${p.price} F</span><br>
            <small>Stock: ${p.stock}</small>
        </div>
    `).join('');

    // Cart
    const c = document.getElementById('cartList');
    c.innerHTML = db.cart.map(i => `
        <div class="cart-item"><span>${i.name} x${i.qty}</span><b>${i.price * i.qty} F</b></div>
    `).join('');
    const tot = db.cart.reduce((s, i) => s + (i.price * i.qty), 0);
    document.getElementById('totalDisplay').innerText = tot + " F";

    // Stats
    const today = new Date().toLocaleDateString();
    const ts = db.sales.filter(s => new Date(s.id).toLocaleDateString() === today);
    document.getElementById('dayRev').innerText = ts.reduce((s, x) => s + x.total, 0) + " F";
    
    const unpaid = db.sales.filter(s => s.status === 'DUE');
    document.getElementById('debtTotal').innerText = unpaid.reduce((s, x) => s + x.total, 0) + " F";
    document.getElementById('debts').innerHTML = unpaid.map(u => `
        <div class="cart-item">
            <span>Dette ${u.total} F</span>
            <button onclick="solve(${u.id})" style="background:var(--green); color:white; border:none; padding:5px; border-radius:5px">SOLDER</button>
        </div>
    `).join('');
}

function addToCart(id) {
    const p = db.prods.find(x => x.id === id);
    if(p.stock <= 0) return alert("Plus de stock !");
    const item = db.cart.find(x => x.id === id);
    if(item) item.qty++; else db.cart.push({...p, qty: 1});
    render();
}

function pay(m) {
    if(db.cart.length === 0) return;
    const tot = db.cart.reduce((s, i) => s + (i.price * i.qty), 0);
    const s = { id: Date.now(), total: tot, method: m, status: m==='CREDIT' ? 'DUE' : 'PAID' };
    
    db.cart.forEach(i => { db.prods.find(p => p.id === i.id).stock -= i.qty; });
    db.sales.push(s);
    db.cart = [];
    save();
    render();
    alert("Vente valid√©e !");
}

function addP() {
    const n = document.getElementById('p_n').value;
    const p = parseInt(document.getElementById('p_p').value);
    const s = parseInt(document.getElementById('p_s').value);
    if(n && p) {
        db.prods.push({id: Date.now(), name: n, price: p, stock: s});
        save();
        render();
        alert("Produit ajout√©");
    }
}

function saveC() {
    db.name = document.getElementById('c_n').value;
    localStorage.setItem('digiy_name', db.name);
    render();
}

function solve(id) {
    db.sales.find(s => s.id === id).status = 'PAID';
    save();
    render();
}

function activate() {
    if(document.getElementById('keyInput').value === "DIGIY-PRO-2026") {
        localStorage.setItem('digiy_active', 'true');
        location.reload();
    } else alert("Cl√© fausse");
}

function activateAdmin() {
    if(document.getElementById('admKey').value === "DIGIY-PRO-2026") {
        localStorage.setItem('digiy_active', 'true');
        location.reload();
    } else alert("Cl√© fausse");
}

function save() {
    localStorage.setItem('digiy_prods', JSON.stringify(db.prods));
    localStorage.setItem('digiy_sales', JSON.stringify(db.sales));
}

// START
render();
</script>
</body>
</html>
