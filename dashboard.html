<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIGIY ELITE — Dashboard Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --gold: #fbbf24; --bg: #0f172a; --card: #1e293b;
            --text: #f8fafc; --muted: #94a3b8;
            --gradient: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
            --green: #10b981; --red: #ef4444; --indigo: #6366f1;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--text); padding: 20px; line-height: 1.6; }

        /* Navigation Onglets */
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .tabs { display: flex; gap: 10px; margin-bottom: 25px; }
        .tab-btn { padding: 12px 20px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); background: var(--card); color: var(--muted); cursor: pointer; font-weight: 700; transition: 0.3s; }
        .tab-btn.active { background: var(--gradient); color: #000; border-color: var(--gold); }

        .main-grid { display: grid; grid-template-columns: 1fr 350px; gap: 25px; }
        @media (max-width: 1000px) { .main-grid { grid-template-columns: 1fr; } }

        .card { background: var(--card); padding: 25px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 25px; }
        .card h3 { color: var(--gold); margin-bottom: 20px; font-size: 16px; border-bottom: 1px solid rgba(251,191,36,0.1); padding-bottom: 10px; }

        .btn { padding: 15px; border: none; border-radius: 12px; font-weight: 800; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%; margin-bottom: 10px; text-decoration: none; }
        .btn-gold { background: var(--gradient); color: #000; }
        .btn-red { background: var(--red); color: white; }
        .btn-indigo { background: var(--indigo); color: white; }

        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; font-size: 11px; color: var(--muted); padding: 10px; }
        td { padding: 12px 10px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 13px; }

        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        @media print {
            .no-print { display: none !important; }
            body { background: white !important; color: black !important; }
            .card { border: none !important; background: white !important; color: black !important; }
        }
    </style>
</head>
<body>

<div class="top-bar no-print">
    <h1 id="storeDisplay">DASHBOARD PRO</h1>
    <a href="index.html" style="color:var(--gold); text-decoration:none; font-weight:800;"><i class="fas fa-arrow-left"></i> RETOUR</a>
</div>

<div class="tabs no-print">
    <div class="tab-btn active" onclick="switchTab('cloture', this)"><i class="fas fa-cash-register"></i> CLÔTURE DU JOUR</div>
    <div class="tab-btn" onclick="switchTab('archives', this)"><i class="fas fa-archive"></i> HISTORIQUE DES Z</div>
</div>

<div id="cloturePage" class="page active">
    <div class="main-grid">
        <div class="left-col">
            <div class="card">
                <h3><i class="fas fa-list"></i> ENCAISSEMENTS EN COURS</h3>
                <table>
                    <thead><tr><th>HEURE</th><th>MONTANT</th><th>MODE</th></tr></thead>
                    <tbody id="salesTableBody"></tbody>
                </table>
            </div>
        </div>
        <div class="right-col no-print">
            <div class="card" style="text-align:center;">
                <small>TOTAL À CLÔTURER (TTC)</small>
                <h2 id="totalTTC" style="font-size:2.2rem; color:var(--gold); margin:10px 0;">0 F</h2>
                <button class="btn btn-indigo" onclick="window.print()"><i class="fas fa-print"></i> IMPRIMER X</button>
                <button class="btn btn-red" onclick="clotureZ()" style="margin-top:20px;"><i class="fas fa-power-off"></i> EFFECTUER CLÔTURE Z</button>
            </div>
        </div>
    </div>
</div>

<div id="archivesPage" class="page">
    <div class="card">
        <h3><i class="fas fa-history"></i> ANCIENNES CLÔTURES (RAPPORTS Z)</h3>
        <table>
            <thead><tr><th>DATE DU Z</th><th>VENTES</th><th>CA TOTAL</th><th>ACTIONS</th></tr></thead>
            <tbody id="archivesTableBody"></tbody>
        </table>
    </div>
</div>

<script>
    function switchTab(id, btn) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id+'Page').classList.add('active');
        btn.classList.add('active');
        if(id === 'archives') renderArchives();
    }

    function loadData() {
        const sales = JSON.parse(localStorage.getItem('el_sales')) || [];
        const today = new Date().toLocaleDateString();
        const currentSales = sales.filter(s => new Date(s.id).toLocaleDateString() === today && !s.archived);
        
        const ttc = currentSales.reduce((a, b) => a + b.total, 0);
        document.getElementById('totalTTC').innerText = ttc.toLocaleString() + " F";
        document.getElementById('salesTableBody').innerHTML = currentSales.map(s => `
            <tr><td>${new Date(s.id).toLocaleTimeString()}</td><td><b>${s.total.toLocaleString()} F</b></td><td>${s.method}</td></tr>
        `).join('');
    }

    function clotureZ() {
        const sales = JSON.parse(localStorage.getItem('el_sales')) || [];
        const today = new Date().toLocaleDateString();
        const current = sales.filter(s => new Date(s.id).toLocaleDateString() === today && !s.archived);

        if(current.length === 0) return alert("Rien à clôturer frérot !");

        if(confirm("Confirmer la clôture Z ?\nLe total sera archivé et la caisse remise à zéro.")) {
            window.print(); // Impression du rapport final
            
            const updatedSales = sales.map(s => {
                if(new Date(s.id).toLocaleDateString() === today) return {...s, archived: true};
                return s;
            });
            localStorage.setItem('el_sales', JSON.stringify(updatedSales));
            location.reload();
        }
    }

    function renderArchives() {
        const sales = JSON.parse(localStorage.getItem('el_sales')) || [];
        // On regroupe les ventes archivées par date
        const archives = {};
        sales.filter(s => s.archived).forEach(s => {
            const d = new Date(s.id).toLocaleDateString();
            if(!archives[d]) archives[d] = { count: 0, total: 0 };
            archives[d].count++;
            archives[d].total += s.total;
        });

        document.getElementById('archivesTableBody').innerHTML = Object.keys(archives).reverse().map(date => `
            <tr>
                <td>${date}</td>
                <td>${archives[date].count} ventes</td>
                <td style="font-weight:bold; color:var(--green);">${archives[date].total.toLocaleString()} F</td>
                <td><button onclick="alert('Rapport de CA pour le ${date} : ${archives[date].total} F')" class="tab-btn" style="padding:5px 10px; font-size:10px;">VOIR</button></td>
            </tr>
        `).join('');
    }

    loadData();
</script>
</body>
</html>
